# è®°å¿†ç³»ç»Ÿä½¿ç”¨åœºæ™¯å¯¹æ¯”

## ğŸ¯ ConversationMemory æœ€ä½³åœºæ™¯

### ğŸ’¬ **çŸ­æœŸå¯¹è¯ä¸Šä¸‹æ–‡**
```
ç”¨æˆ·ï¼šåˆ—å‡ºæ‰€æœ‰åˆ—æ—
æ™ºèƒ½ä½“ï¼šæ•°æ®åº“ä¸­æœ‰ï¼šusers, products, orders

ç”¨æˆ·ï¼šusersé‡Œé¢æœ‰ä»€ä¹ˆï¼Ÿ  # â† ç›´æ¥å¼•ç”¨ä¸Šä¸€è½®å¯¹è¯
æ™ºèƒ½ä½“ï¼šusersåˆ—æ—åŒ…å«ç”¨æˆ·æ•°æ®...
```
**ä¼˜åŠ¿**ï¼šå®Œç¾å¤„ç†æŒ‡ä»£è¯å’Œä¸Šä¸‹æ–‡å¼•ç”¨

### ğŸ”„ **è¿ç»­æ€§æ“ä½œ**
```
ç”¨æˆ·ï¼šæŸ¥çœ‹productsè¡¨ç»Ÿè®¡
æ™ºèƒ½ä½“ï¼šproductsæœ‰1000æ¡è®°å½•

ç”¨æˆ·ï¼šéšæœºæ˜¾ç¤ºå‡ æ¡  # â† çŸ¥é“æ˜¯productsè¡¨
æ™ºèƒ½ä½“ï¼š[æ˜¾ç¤ºproductsæ•°æ®]

ç”¨æˆ·ï¼šè¿™äº›æ•°æ®çš„æ ¼å¼çœ‹èµ·æ¥ä¸å¯¹  # â† çŸ¥é“æŒ‡ä»€ä¹ˆæ•°æ®
æ™ºèƒ½ä½“ï¼šæˆ‘æ¥åˆ†ææ•°æ®æ ¼å¼é—®é¢˜...
```
**ä¼˜åŠ¿**ï¼šç»´æŠ¤æ“ä½œçš„è¿ç»­æ€§

### âš¡ **å®æ—¶äº¤äº’**
```
ç”¨æˆ·ï¼šæ‰«æuser:å¼€å¤´çš„é”®
æ™ºèƒ½ä½“ï¼šæ‰¾åˆ°50ä¸ªç”¨æˆ·è®°å½•

ç”¨æˆ·ï¼šåªæ˜¾ç¤ºå‰10ä¸ª  # â† åŸºäºåˆšæ‰çš„æ‰«æç»“æœ
æ™ºèƒ½ä½“ï¼š[æ˜¾ç¤ºå‰10ä¸ª]
```
**ä¼˜åŠ¿**ï¼šæ— å»¶è¿Ÿçš„å³æ—¶å“åº”

## ğŸ” VectorDB Memory æœ€ä½³åœºæ™¯

### ğŸ“š **çŸ¥è¯†åº“ç®¡ç†**
```
# å†å²å¯¹è¯å­˜å‚¨ä¸ºå‘é‡
"å¦‚ä½•ä¼˜åŒ–RocksDBæ€§èƒ½" -> å‘é‡åŒ–å­˜å‚¨
"å‹ç¼©ç­–ç•¥é…ç½®æ–¹æ³•" -> å‘é‡åŒ–å­˜å‚¨
"ç´¢å¼•ä¼˜åŒ–æŠ€å·§" -> å‘é‡åŒ–å­˜å‚¨

# æ–°é—®é¢˜è¯­ä¹‰æœç´¢
ç”¨æˆ·ï¼šæˆ‘çš„æ•°æ®åº“å¾ˆæ…¢ï¼Œæ€ä¹ˆåŠï¼Ÿ
æ™ºèƒ½ä½“ï¼š[æ£€ç´¢åˆ°ç›¸å…³çš„æ€§èƒ½ä¼˜åŒ–çŸ¥è¯†] æ ¹æ®ä»¥å¾€ç»éªŒ...
```
**ä¼˜åŠ¿**ï¼šæ™ºèƒ½çš„çŸ¥è¯†å‘ç°å’Œå¤ç”¨

### ğŸ”¬ **è·¨ä¼šè¯å­¦ä¹ **
```
# Session 1 (ä¸Šå‘¨)
ç”¨æˆ·ï¼šè¿™ä¸ªé”™è¯¯ä¿¡æ¯æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ
æ™ºèƒ½ä½“ï¼šè¿™æ˜¯å†…å­˜ä¸è¶³å¯¼è‡´çš„...

# Session 2 (ä»Šå¤©)
ç”¨æˆ·ï¼šåˆå‡ºç°å†…å­˜ç›¸å…³çš„é”™è¯¯äº†
æ™ºèƒ½ä½“ï¼š[è‡ªåŠ¨æ£€ç´¢åˆ°ä¸Šå‘¨çš„è§£å†³æ–¹æ¡ˆ] ä½ ä¸Šæ¬¡é‡åˆ°è¿‡ç±»ä¼¼é—®é¢˜...
```
**ä¼˜åŠ¿**ï¼šè·¨æ—¶é—´çš„ç»éªŒç´¯ç§¯

### ğŸ“– **æ–‡æ¡£æ£€ç´¢**
```
ç”¨æˆ·ï¼šå¦‚ä½•é…ç½®åˆ—æ—å‹ç¼©ï¼Ÿ
æ™ºèƒ½ä½“ï¼š[ä»å‘é‡æ•°æ®åº“æ£€ç´¢ç›¸å…³æ–‡æ¡£] 
æ ¹æ®RocksDBæ–‡æ¡£ï¼Œåˆ—æ—å‹ç¼©å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼é…ç½®...
```
**ä¼˜åŠ¿**ï¼šå¤§é‡æ–‡æ¡£çš„è¯­ä¹‰æœç´¢

## âš–ï¸ æŠ€æœ¯å®ç°å¯¹æ¯”

### ConversationMemory å®ç°
```go
// ç®€å•é«˜æ•ˆçš„å†…å­˜å®ç°
type ConversationMemory struct {
    history []ConversationTurn  // ç›´æ¥æ•°ç»„å­˜å‚¨
    maxSize int                 // æ»‘åŠ¨çª—å£
}

// å¿«é€Ÿæ£€ç´¢
func (cm *ConversationMemory) LoadMemoryVariables(ctx context.Context, inputs map[string]any) (map[string]any, error) {
    // O(1) æ—¶é—´å¤æ‚åº¦
    messages := cm.getChatMessages()
    return map[string]any{"chat_history": messages}, nil
}
```

### VectorDB Memory å®ç°
```go
// å¤æ‚ä½†å¼ºå¤§çš„å‘é‡å®ç°
type VectorMemory struct {
    vectorStore vectorstores.VectorStore  // Chroma/Pinecone
    embedder    embeddings.Embedder       // OpenAI/Ollama embeddings
}

// è¯­ä¹‰æ£€ç´¢
func (vm *VectorMemory) LoadMemoryVariables(ctx context.Context, inputs map[string]any) (map[string]any, error) {
    query := inputs["input"].(string)
    
    // 1. å‘é‡åŒ–æŸ¥è¯¢ (100-500ms)
    queryVector := vm.embedder.EmbedQuery(ctx, query)
    
    // 2. è¯­ä¹‰æœç´¢ (50-200ms)  
    similar := vm.vectorStore.SimilaritySearch(ctx, query, 5)
    
    return map[string]any{"relevant_memory": similar}, nil
}
```

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

| ç‰¹æ€§ | ConversationMemory | VectorDB Memory |
|-----|-------------------|-----------------|
| **å“åº”æ—¶é—´** | 1-5ms | 100-500ms |
| **å­˜å‚¨å®¹é‡** | å‡ ç™¾è½®å¯¹è¯ | æ— é™åˆ¶ |
| **æŸ¥è¯¢ç²¾åº¦** | æ—¶é—´ç›¸å…³æ€§ | è¯­ä¹‰ç›¸å…³æ€§ |
| **èµ„æºæ¶ˆè€—** | æä½ | ä¸­ç­‰ |
| **é…ç½®å¤æ‚åº¦** | ç®€å• | å¤æ‚ |
| **ä¾èµ–æ€§** | æ—  | å‘é‡æ•°æ®åº“ |

## ğŸš€ æ··åˆä½¿ç”¨ç­–ç•¥

### åŒé‡è®°å¿†æ¶æ„
```go
type HybridMemory struct {
    conversation *ConversationMemory  // çŸ­æœŸè®°å¿†
    vector       *VectorMemory        // é•¿æœŸè®°å¿†
}

func (hm *HybridMemory) LoadMemoryVariables(ctx context.Context, inputs map[string]any) (map[string]any, error) {
    result := make(map[string]any)
    
    // 1. åŠ è½½çŸ­æœŸä¸Šä¸‹æ–‡ (1-5ms)
    shortTerm, _ := hm.conversation.LoadMemoryVariables(ctx, inputs)
    result["chat_history"] = shortTerm["chat_history"]
    
    // 2. å¼‚æ­¥åŠ è½½é•¿æœŸçŸ¥è¯† (100-500ms)
    go func() {
        longTerm, _ := hm.vector.LoadMemoryVariables(ctx, inputs)
        // åå°å¤„ç†ç›¸å…³çŸ¥è¯†
    }()
    
    return result, nil
}
```

### æ™ºèƒ½è·¯ç”±ç­–ç•¥
```go
func (hm *HybridMemory) RouteQuery(query string) MemoryType {
    // çŸ­æœŸæŸ¥è¯¢ï¼šåŒ…å«æŒ‡ä»£è¯
    if containsReferences(query) {  // "è¿™ä¸ª"ã€"åˆšæ‰çš„"ã€"é‚£äº›"
        return ConversationMemoryType
    }
    
    // é•¿æœŸæŸ¥è¯¢ï¼šçŸ¥è¯†æ€§é—®é¢˜
    if isKnowledgeQuery(query) {    // "å¦‚ä½•"ã€"ä¸ºä»€ä¹ˆ"ã€"æœ€ä½³å®è·µ"
        return VectorMemoryType
    }
    
    // æ··åˆæŸ¥è¯¢ï¼šå¤æ‚åˆ†æ
    return HybridMemoryType
}
```

## ğŸ¯ é€‰æ‹©å»ºè®®

### é€‰æ‹© ConversationMemory å½“ï¼š
- âœ… éœ€è¦**å¿«é€Ÿå“åº”**ï¼ˆ<10msï¼‰
- âœ… å¤„ç†**å¯¹è¯å¼äº¤äº’**
- âœ… **ç®€å•éƒ¨ç½²**éœ€æ±‚
- âœ… **èµ„æºæœ‰é™**ç¯å¢ƒ

### é€‰æ‹© VectorDB Memory å½“ï¼š
- âœ… éœ€è¦**è·¨ä¼šè¯çŸ¥è¯†**
- âœ… å¤„ç†**å¤§é‡å†å²æ•°æ®**
- âœ… **è¯­ä¹‰æœç´¢**éœ€æ±‚
- âœ… **çŸ¥è¯†ç®¡ç†**åº”ç”¨

### é€‰æ‹©æ··åˆæ–¹æ¡ˆå½“ï¼š
- âœ… **ä¼ä¸šçº§åº”ç”¨**
- âœ… **å¤æ‚åœºæ™¯**éœ€æ±‚
- âœ… æœ‰**å……è¶³èµ„æº**
- âœ… éœ€è¦**æœ€ä½³ç”¨æˆ·ä½“éªŒ**

## ğŸ’¡ æœªæ¥æ¼”è¿›è·¯å¾„

1. **ç¬¬ä¸€é˜¶æ®µ**ï¼šConversationMemoryï¼ˆå·²å®Œæˆï¼‰
   - å¿«é€Ÿéƒ¨ç½²ï¼Œå³æ—¶ä»·å€¼
   
2. **ç¬¬äºŒé˜¶æ®µ**ï¼šVectorDBé›†æˆ
   - æ·»åŠ æŒä¹…åŒ–è¯­ä¹‰è®°å¿†
   
3. **ç¬¬ä¸‰é˜¶æ®µ**ï¼šæ™ºèƒ½æ··åˆ
   - è‡ªåŠ¨é€‰æ‹©æœ€ä½³è®°å¿†ç­–ç•¥
   
4. **ç¬¬å››é˜¶æ®µ**ï¼šè‡ªé€‚åº”å­¦ä¹ 
   - åŸºäºä½¿ç”¨æ¨¡å¼ä¼˜åŒ–è®°å¿†ç­–ç•¥ 